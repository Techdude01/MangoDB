{% extends "base.html" %}

{% block style %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='./css/home.css') }}">
{% endblock %}

{% block title %}
Mango Homepage
{% endblock %}

{% block body %}
<nav class="navbar">
    <ul>
        <li><a href="{{ url_for('home') }}">Home</a></li>
        <li><a href="{{ url_for('register_route') }}">Register</a></li>
        <li><a href="{{ url_for('most_popular') }}">Most Popular</a></li>
        <li><a href="{{ url_for('most_recent') }}">Most Recent</a></li>
        <li><a href="{{ url_for('most_controversial') }}">Most Controversial</a></li>

    </ul>
</nav>
<div class="main">
    <div class="main-query">
        <h1>Search Bar</h1>
        <h3>Query by Username, Keyword in Question Text, or Tag!</h3>
        <form id="search-form" action="{{ url_for('home') }}" method="get">
            <!-- Search by Username -->
            <div>
                <label for="username">
                    Username:
                </label>
                <input type="text" id="username" name="username" placeholder="Enter username">
            </div>
            <!-- Search by Keyword in Question Text -->
            <div>
                <label for="keyword">
                    Keyword:
                </label>
                <input type="text" id="keyword" name="keyword" placeholder="Enter keyword in question text">
            </div>
            <!-- Search by Tag -->
            <div>
                <label for="tag">Tag:</label>
                <input type="text" id="tag" placeholder="Enter tag name">
            </div>

            <!-- Submit Button -->
            <div class="wrap">
                <button type="button" onclick="validateSearchForm()">
                    Search
                </button>
            </div>
        </form>

        <script>
            function validateSearchForm() {
                var username = document.getElementById("username").value;
                var keyword = document.getElementById("keyword").value;

                if (!username && !keyword) {
                    alert("Please enter either a Username or a Keyword to search.");
                    return false;
                }

                document.getElementById("search-form").submit();
            }
        </script>
    </div>

    <!-- Post Question Section -->
    <div class="post-question">
        <button id="post-question-btn" onclick="toggleQuestionForm()">Post a Question</button>

        <div id="question-form" style="display: none;">
            <form action="{{ url_for('publish_question') }}" method="post">
                <div>
                    <label for="question-text">Question:</label>
                    <textarea id="question-text" name="question_text" placeholder="Write your question here..."
                        required></textarea>
                </div>

                <div>
                    <label for="tags">Tags:</label>
                    <select id="tags" name="tags" multiple required>
                        {% for tag in tags %}
                        <option value="{{ tag['tagID'] }}">{{ tag['tagName'] }}</option>
                        {% endfor %}
                    </select>
                </div>

                <button type="submit">Post Question</button>
            </form>
        </div>
    </div>

    <div class="user-login">
        <h1>User Login</h1>
        <h3>Enter your login credentials</h3>
        <form id="login-form" action="{{ url_for('home') }}" method="post">
            <label for="login-username">
                Username:
            </label>
            <input type="text" id="login-username" name="username" placeholder="Enter your Username" required>

            <label for="login-password">
                Password:
            </label>
            <input type="password" id="login-password" name="password" placeholder="Enter your Password" required>
            <div class="wrap">
                <button type="button" onclick="validateLoginForm()">
                    Login
                </button>
            </div>
            <!-- <p><a href="{{ url_for('login')}}" style="text-decoration:none">User Login</a></p> -->
        </form>

        <script>
            function validateLoginForm() {
                var username = document.getElementById("login-username").value;
                var password = document.getElementById("login-password").value;
                if (!username || !password) {
                    alert("Please enter both Username and Password.");
                    return false;
                }

                document.getElementById("login-form").submit();
            }
        </script>
    </div>
    <!-- Section for Most Popular Questions -->
    <div class="section">
        <h2><a href="{{ url_for('most_popular') }}">Most Popular</a></h2>
        <ul>
            {% for question in most_popular %}
            {% if question['questionID'] is defined and question['questionText'] is defined %}
            <li>
                <a href="{{ url_for('question_detail', question_id=question['questionID']) }}">
                    {{ question['questionText'] }}
                </a>
            </li>
            {% endif %}

            {% endfor %}
        </ul>
        <div class="pagination">
            {% if most_popular_page > 1 %}
            <a href="{{ url_for('most_popular', page=most_popular_page-1) }}">Previous</a>
            {% endif %}

            <span>Page {{ most_popular_page }} of {{ most_popular_total_pages }}</span>

            {% if most_popular_page < most_popular_total_pages %} <a
                href="{{ url_for('most_popular', page=most_popular_page+1) }}">Next</a>
                {% endif %}
        </div>
    </div>
    <!-- Section for Most Controversial Questions -->
    <div class="section">
        <h2><a href="{{ url_for('most_controversial') }}">Most Controversial</a></h2>
        <ul>
            {% for question in most_controversial %}
            {% if question['questionID'] is defined and question['questionText'] is defined %}
            <li>
                <a href="{{ url_for('question_detail', question_id=question['questionID']) }}">
                    {{ question['questionText'] }}
                </a>
            </li>
            {% endif %}

            {% endfor %}
        </ul>
        <div class="pagination">
            {% if most_controversial_page > 1 %}
            <a href="{{ url_for('most_controversial', page=most_controversial_page-1) }}">Previous</a>
            {% endif %}

            <span>Page {{ most_controversial_page }} of {{ most_controversial_total_pages }}</span>

            {% if most_controversial_page < most_controversial_total_pages %} <a
                href="{{ url_for('most_controversial', page=most_controversial_page+1) }}">Next</a>
                {% endif %}
        </div>
    </div>
    <!-- Section for Most Recent Questions -->
    <div class="section">
        <h2><a href="{{ url_for('most_recent') }}">Most Recent</a></h2>
        <ul>
            {% for question in most_recent %}
            {% if question['questionID'] is defined and question['questionText'] is defined %}
            <li>
                <a href="{{ url_for('question_detail', question_id=question['questionID']) }}">
                    {{ question['questionText'] }}
                </a>
            </li>
            {% endif %}

            {% endfor %}
        </ul>
        <div class="pagination">
            {% if most_recent_page > 1 %}
            <a href="{{ url_for('most_recent', page=most_recent_page-1) }}">Previous</a>
            {% endif %}

            <span>Page {{ most_recent_page }} of {{ most_recent_total_pages }}</span>

            {% if most_recent_page < most_recent_total_pages %} <a
                href="{{ url_for('most_recent', page=most_recent_page+1) }}">Next</a>
                {% endif %}
        </div>
    </div>
    <div class="post-question">
        <button id="post-question-btn" onclick="toggleQuestionForm()">Post a Question</button>

        <div id="question-form" style="display: none;">
            <form action="{{ url_for('publish_question') }}" method="post">
                <input type="hidden" name="question_id" id="question-id"> <!-- Question ID -->

                <div>
                    <label for="question-text">Question:</label>
                    <textarea id="question-text" name="question_text" placeholder="Write your question here..."
                        required></textarea>
                </div>

                <div>
                    <label for="tags">Select Tags:</label>
                    <select id="tags" name="tags" multiple required>
                        {% for tag in tags %}
                        <option value="{{ tag['tagID'] }}">{{ tag['tagName'] }}</option>
                        {% endfor %}
                    </select>
                </div>

                <button type="submit">Publish Question</button>
            </form>
        </div>
    </div>
    <script>
        function toggleQuestionForm() {
            const form = document.getElementById('question-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }
        function startDraft() {
            document.getElementById('start-question-form').submit();
            document.getElementById('publish-question-form').style.display = 'block';
            document.getElementById('cancel-question-form').style.display = 'block';
        }
    </script>
    {% endblock %}